import{a as ot}from"./chunk-Q2OJFNM2.js";import{a as rt,b as lt}from"./chunk-MXQJHEDE.js";import{a as gt}from"./chunk-FOKHRKZU.js";import"./chunk-QPOBV5UM.js";import{a as ct,c as mt,d as st,f as pt,g as dt,h as ut,i as _t,l as ft,m as Ct,n as vt}from"./chunk-VY3RHVZS.js";import{a as at}from"./chunk-OWNJBPSF.js";import{$ as q,Aa as m,Ba as Q,Ca as C,Fa as V,Ga as R,Ha as x,I as H,Ja as w,Ka as E,L as T,La as X,O,P as u,Pa as Y,Q as _,Ra as I,S as G,Sa as Z,Ua as tt,W,X as S,Ya as et,_a as it,aa as J,ab as nt,ba as k,bb as D,ca as r,da as b,eb as L,fb as F,ha as K,i as B,k as A,l as z,la as g,ma as c,oa as h,pa as M,qa as U,ra as j,sa as a,t as P,ta as l,ua as d,va as v,wa as f,xa as p}from"./chunk-OD32AHD5.js";import{d as $}from"./chunk-4UQR44R5.js";var xt=(()=>{let o=class o{constructor(){this.domSanitizer=S(et)}transform(n){return $(this,null,function*(){let{marked:i}=yield import("./chunk-THE56IWZ.js");return this.domSanitizer.sanitize(q.HTML,i.parse(n))||""})}};o.\u0275fac=function(i){return new(i||o)},o.\u0275pipe=O({name:"markdown",type:o,pure:!0,standalone:!0});let e=o;return e})();function Et(e,o){if(e&1){let t=v();a(0,"span",9)(1,"i",10),f("click",function(){u(t);let i=p(2);return _(i.delete.emit(!0))}),l()()}}var ht=e=>["/profile",e];function Ft(e,o){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"p",3),m(3),l()(),a(4,"div",4)(5,"a",5),d(6,"img",6),l(),m(7," \xA0 "),a(8,"a",5),m(9),l(),a(10,"span",7),m(11),w(12,"date"),l(),g(13,Et,2,0,"span",8),w(14,"async"),l()()),e&2){let t=p();r(3),C(" ",t.comment.body," "),r(2),c("routerLink",x(12,ht,t.comment.author.username)),r(),c("src",t.comment.author.image,k),r(2),c("routerLink",x(14,ht,t.comment.author.username)),r(),C(" ",t.comment.author.username," "),r(2),C(" ",X(12,7,t.comment.createdAt,"longDate")," "),r(2),h(13,E(14,10,t.canModify$)?13:-1)}}var yt=(()=>{let o=class o{constructor(){this.delete=new H,this.canModify$=S(L).currentUser.pipe(A(n=>n?.username===this.comment.author.username))}};o.\u0275fac=function(i){return new(i||o)},o.\u0275cmp=T({type:o,selectors:[["app-article-comment"]],inputs:{comment:"comment"},outputs:{delete:"delete"},standalone:!0,features:[V],decls:1,vars:1,consts:[["class","card"],[1,"card"],[1,"card-block"],[1,"card-text"],[1,"card-footer"],[1,"comment-author",3,"routerLink"],[1,"comment-author-img",3,"src"],[1,"date-posted"],["class","mod-options"],[1,"mod-options"],[1,"ion-trash-a",3,"click"]],template:function(i,s){i&1&&g(0,Ft,15,16,"div",0),i&2&&h(0,s.comment?0:-1)},dependencies:[D,Z,I],encapsulation:2});let e=o;return e})();var St=(()=>{let o=class o{constructor(n){this.http=n}getAll(n){return this.http.get(`/articles/${n}/comments`).pipe(A(i=>i.comments))}add(n,i){return this.http.post(`/articles/${n}/comments`,{comment:{body:i}}).pipe(A(s=>s.comment))}delete(n,i){return this.http.delete(`/articles/${i}/comments/${n}`)}};o.\u0275fac=function(i){return new(i||o)(W(tt))},o.\u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"});let e=o;return e})();var bt=e=>["/editor",e],wt=e=>({disabled:e});function kt(e,o){if(e&1){let t=v();a(0,"span")(1,"a",14),d(2,"i",15),m(3," Edit Article "),l(),a(4,"button",16),f("click",function(){u(t);let i=p(2);return _(i.deleteArticle())}),d(5,"i",17),m(6," Delete Article "),l()()}if(e&2){let t=p(2);r(),c("routerLink",x(2,bt,t.article.slug)),r(3),c("ngClass",x(4,wt,t.isDeleting))}}function Vt(e,o){if(e&1){let t=v();a(0,"span")(1,"app-follow-button",18),f("toggle",function(i){u(t);let s=p(2);return _(s.toggleFollowing(i))}),l(),a(2,"app-favorite-button",19),f("toggle",function(i){u(t);let s=p(2);return _(s.onToggleFavorite(i))}),m(3),a(4,"span",20),m(5),l()()()}if(e&2){let t=p(2);r(),c("profile",t.article.author),r(),c("article",t.article),r(),C(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),r(2),C("(",t.article.favoritesCount,")")}}function It(e,o){if(e&1&&(a(0,"li",21),m(1),l()),e&2){let t=o.$implicit;r(),C(" ",t," ")}}function Dt(e,o){if(e&1){let t=v();a(0,"span")(1,"a",14),d(2,"i",15),m(3," Edit Article "),l(),a(4,"button",16),f("click",function(){u(t);let i=p(2);return _(i.deleteArticle())}),d(5,"i",17),m(6," Delete Article "),l()()}if(e&2){let t=p(2);r(),c("routerLink",x(2,bt,t.article.slug)),r(3),c("ngClass",x(4,wt,t.isDeleting))}}function Lt(e,o){if(e&1){let t=v();a(0,"span")(1,"app-follow-button",18),f("toggle",function(i){u(t);let s=p(2);return _(s.toggleFollowing(i))}),l(),a(2,"app-favorite-button",19),f("toggle",function(i){u(t);let s=p(2);return _(s.onToggleFavorite(i))}),m(3),a(4,"span",20),m(5),l()()()}if(e&2){let t=p(2);r(),c("profile",t.article.author),r(),c("article",t.article),r(),C(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),r(2),C("(",t.article.favoritesCount,")")}}function Mt(e,o){if(e&1){let t=v();a(0,"div"),d(1,"app-list-errors",22),a(2,"form",23),f("ngSubmit",function(){u(t);let i=p(2);return _(i.addComment())}),a(3,"fieldset",24)(4,"div",25),d(5,"textarea",26),l(),a(6,"div",27),d(7,"img",28),a(8,"button",29),m(9," Post Comment "),l()()()()()}if(e&2){let t=p(2);r(),c("errors",t.commentFormErrors),r(2),c("disabled",t.isSubmitting),r(2),c("formControl",t.commentControl),r(2),c("src",(t.currentUser==null?null:t.currentUser.image)===null?"":t.currentUser==null?null:t.currentUser.image,k)}}var Ut=()=>["/login"],jt=()=>["/register"];function Rt(e,o){e&1&&(a(0,"div")(1,"a",30),m(2,"Sign in"),l(),m(3," or "),a(4,"a",30),m(5,"sign up"),l(),m(6," to add comments on this article. "),l()),e&2&&(r(),c("routerLink",R(2,Ut)),r(3),c("routerLink",R(3,jt)))}function Nt(e,o){if(e&1){let t=v();a(0,"app-article-comment",31),f("delete",function(){let s=u(t).$implicit,y=p(2);return _(y.deleteComment(s))}),l()}if(e&2){let t=o.$implicit;c("comment",t)}}function $t(e,o){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),m(4),l(),a(5,"app-article-meta",4),g(6,kt,7,6,"span")(7,Vt,6,4),l()()(),a(8,"div",5)(9,"div",6)(10,"div",7),d(11,"div",8),w(12,"async"),w(13,"markdown"),a(14,"ul",9),U(15,It,2,1,"li",32,M),l()()(),d(17,"hr"),a(18,"div",10)(19,"app-article-meta",4),g(20,Dt,7,6,"span")(21,Lt,6,4),l()(),a(22,"div",11)(23,"div",12),g(24,Mt,10,4,"div",13)(25,Rt,7,4,"div",13),U(26,Nt,1,1,"app-article-comment",33,M),l()()()()),e&2){let t=p();r(4),Q(t.article.title),r(),c("article",t.article),r(),h(6,t.canModify?6:7),r(5),c("innerHTML",E(12,8,E(13,10,t.article.body)),J),r(4),j(t.article.tagList),r(4),c("article",t.article),r(),h(20,t.canModify?20:21),r(4),c("ifAuthenticated",!0),r(),c("ifAuthenticated",!1),r(),j(t.comments)}}var we=(()=>{let o=class o{constructor(n,i,s,y,At){this.route=n,this.articleService=i,this.commentsService=s,this.router=y,this.userService=At,this.comments=[],this.canModify=!1,this.commentControl=new dt("",{nonNullable:!0}),this.commentFormErrors=null,this.isSubmitting=!1,this.isDeleting=!1,this.destroyRef=S(K)}ngOnInit(){let n=this.route.snapshot.params.slug;z([this.articleService.get(n),this.commentsService.getAll(n),this.userService.currentUser]).pipe(P(i=>(this.router.navigate(["/"]),B(()=>i))),F(this.destroyRef)).subscribe(([i,s,y])=>{this.article=i,this.comments=s,this.currentUser=y,this.canModify=y?.username===i.author.username})}onToggleFavorite(n){this.article.favorited=n,n?this.article.favoritesCount++:this.article.favoritesCount--}toggleFollowing(n){this.article.author.following=n.following}deleteArticle(){this.isDeleting=!0,this.articleService.delete(this.article.slug).pipe(F(this.destroyRef)).subscribe(()=>{this.router.navigate(["/"])})}addComment(){this.isSubmitting=!0,this.commentFormErrors=null,this.commentsService.add(this.article.slug,this.commentControl.value).pipe(F(this.destroyRef)).subscribe({next:n=>{this.comments.unshift(n),this.commentControl.reset(""),this.isSubmitting=!1},error:n=>{this.isSubmitting=!1,this.commentFormErrors=n}})}deleteComment(n){this.commentsService.delete(n.id,this.article.slug).pipe(F(this.destroyRef)).subscribe(()=>{this.comments=this.comments.filter(i=>i!==n)})}};o.\u0275fac=function(i){return new(i||o)(b(it),b(at),b(St),b(nt),b(L))},o.\u0275cmp=T({type:o,selectors:[["app-article-page"]],standalone:!0,features:[V],decls:1,vars:1,consts:[["class","article-page"],[1,"article-page"],[1,"banner"],[1,"container"],[3,"article"],[1,"container","page"],[1,"row","article-content"],[1,"col-md-12"],[3,"innerHTML"],[1,"tag-list"],[1,"article-actions"],[1,"row"],[1,"col-xs-12","col-md-8","offset-md-2"],[4,"ifAuthenticated"],[1,"btn","btn-sm","btn-outline-secondary",3,"routerLink"],[1,"ion-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"ngClass","click"],[1,"ion-trash-a"],[3,"profile","toggle"],[3,"article","toggle"],[1,"counter"],[1,"tag-default","tag-pill","tag-outline"],[3,"errors"],[1,"card","comment-form",3,"ngSubmit"],[3,"disabled"],[1,"card-block"],["placeholder","Write a comment...","rows","3",1,"form-control",3,"formControl"],[1,"card-footer"],[1,"comment-author-img",3,"src"],["type","submit",1,"btn","btn-sm","btn-primary"],[3,"routerLink"],[3,"comment","delete"],["class","tag-default tag-pill tag-outline"],[3,"comment"]],template:function(i,s){i&1&&g(0,$t,28,12,"div",0),i&2&&h(0,s.article?0:-1)},dependencies:[rt,D,Y,gt,lt,xt,I,vt,ft,ut,ct,mt,st,pt,yt,Ct,_t,ot],encapsulation:2});let e=o;return e})();export{we as default};
